<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FSR Viagens | Vitrine de Pacotes</title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

</head>
<body>
    <div id="root">
        </div>

    <script type="text/babel">
        // Dados de Exemplo (Pacotes da Vitrine)
        const pacotesExemplo = [
            { id: 1, nome: "Fortaleza com Praia da Lagoinha", saida: "Curitiba, Londrina e Cascavel" },
            { id: 2, nome: "Salvador com Morro de São Paulo", saida: "Variadas" },
            { id: 3, nome: "Egito 2X1 | Pacote 08 dias e 07 noites", saida: "São Paulo, Rio de Janeiro (bloqueios)" },
            { id: 4, nome: "Réveillon na Tailândia com Festival das Lanternas", saida: "Variadas" },
        ];

        const WHATSAPP_NUMBER = '5561983163710';
        const API_URL = '/capturar_lead'; // Rota Python para salvar o lead

        const LandingPageIncomum = () => {
            const [nome, setNome] = React.useState('');
            const [telefone, setTelefone] = React.useState('');
            const [pacoteSelecionado, setPacoteSelecionado] = React.useState('');
            const [dataViagem, setDataViagem] = React.useState('');
            const [passageiros, setPassageiros] = React.useState(1);
            const [erro, setErro] = React.useState('');
            const [loading, setLoading] = React.useState(false);

            const handleWhatsAppRedirect = async (e) => {
                e.preventDefault();
                setErro('');
                
                // 1. Validação OBRIGATÓRIA
                if (!nome || !telefone || !pacoteSelecionado || passageiros < 1) {
                    setErro('Por favor, preencha seu Nome, Telefone, Pacote e Quantidade de Passageiros.');
                    return;
                }
                
                setLoading(true);

                const formData = {
                    nome, telefone, pacoteSelecionado, dataViagem, passageiros
                };

                // 2. Tenta capturar o lead (AUTOMAÇÃO PRINCIPAL no Python)
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });

                    const result = await response.json();

                    if (!response.ok) {
                        // Se o Python falhar em salvar (raro), ainda assim tentamos o WhatsApp
                        console.error("Erro ao salvar o lead no Python:", result.message);
                    }
                    
                    // 3. Montagem da Mensagem e Redirecionamento para o WhatsApp
                    let mensagem = `Olá, FSR Viagens & Turismo! Meu nome é ${nome}.`;
                    mensagem += `\nTenho interesse no pacote: *${pacoteSelecionado}*`;
                    mensagem += `\nQuantidade de passageiros: ${passageiros}`;
                    
                    if (dataViagem) {
                        mensagem += `\nData pretendida: ${dataViagem}`;
                    } else {
                        mensagem += `\n**IMPORTANTE:** A data ainda não foi definida, mas gostaria de ver as opções.`;
                    }
                    
                    mensagem += `\nMeu telefone para contato é: ${telefone}. Aguardo o retorno!`;

                    const encodedMessage = encodeURIComponent(mensagem);
                    const whatsappURL = `https://api.whatsapp.com/send?phone=${WHATSAPP_NUMBER}&text=${encodedMessage}`;

                    window.open(whatsappURL, '_blank');

                } catch (error) {
                    setErro('Ocorreu um erro de comunicação. Tente novamente.');
                    console.error("Erro de rede:", error);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="container form-container">
                    <header className="header__content" style={{ display: 'block', padding: 'var(--space-md)' }}>
                        {/* 1. CORREÇÃO DA LOGO: Usa o arquivo 7545.webp e a classe BEM logo__image */}
                        <img 
                            src="{{ url_for('static', filename='7545.webp') }}" 
                            alt="FSR Viagens & Turismo Logo" 
                            className="logo__image" 
                            style={{ maxWidth: '180px', margin: '0 auto', marginBottom: 'var(--space-md)' }} 
                        />
                        {/* 2. CORREÇÃO DAS CLASSES DE TÍTULO */}
                        <h2 className="hero__headline" style={{ color: 'var(--primary-color)', marginBottom: 'var(--space-sm)' }}>
                            Escolha o seu Pacote FSR e Fale Conosco!
                        </h2>
                        <p className="hero__slogan">
                            Preencha os dados abaixo para receber um atendimento personalizado via WhatsApp.
                        </p>
                    </header>

                    {/* 3. CORREÇÃO DA CLASSE DO FORMULÁRIO: Usa a classe BEM form */}
                    <form onSubmit={handleWhatsAppRedirect} className="form">
                        
                        {/* Seção de Pacote */}
                        <div className="form-section">
                            <h3>1. Pacote e Destino</h3>
                            <div className="form__group">
                                <label htmlFor="pacote-select">Selecione o Pacote de Interesse:</label>
                                <select
                                    id="pacote-select"
                                    value={pacoteSelecionado}
                                    onChange={(e) => setPacoteSelecionado(e.target.value)}
                                    required
                                >
                                    <option value="">-- Escolha um destino --</option>
                                    {pacotesExemplo.map((pacote) => (
                                        <option key={pacote.id} value={pacote.nome}>
                                            {pacote.nome} (Saída: {pacote.saida})
                                        </option>
                                    ))}
                                </select>
                            </div>
                        </div>
                        
                        {/* Seção de Contato e Passageiros */}
                        <div className="form-section">
                            <h3>2. Dados Pessoais e da Viagem</h3>
                            
                            <div className="form__group">
                                <label htmlFor="nome-input">*Seu Nome Completo:</label>
                                <input
                                    id="nome-input"
                                    type="text"
                                    value={nome}
                                    onChange={(e) => setNome(e.target.value)}
                                    required
                                />
                            </div>
                            
                            <div className="form__group">
                                <label htmlFor="telefone-input">*Seu Telefone (com DDD):</label>
                                <input
                                    id="telefone-input"
                                    type="tel"
                                    value={telefone}
                                    onChange={(e) => setTelefone(e.target.value.replace(/[^0-9]/g, ''))} 
                                    required
                                />
                            </div>

                            <div className="form__group">
                                <label htmlFor="passageiros-input">*Quantidade de Passageiros:</label>
                                <input
                                    id="passageiros-input"
                                    type="number"
                                    min="1"
                                    value={passageiros}
                                    onChange={(e) => setPassageiros(parseInt(e.target.value) || 1)}
                                    required
                                />
                            </div>

                            <div className="form__group">
                                <label htmlFor="data-viagem-input">Data Preferencial de Viagem:</label>
                                <input
                                    id="data-viagem-input"
                                    type="date" 
                                    value={dataViagem}
                                    onChange={(e) => setDataViagem(e.target.value)}
                                />
                                {/* CORREÇÃO DA CLASSE DE TEXTO DE AJUDA */}
                                <small className="help-text">
                                    Se não tiver certeza, deixe em branco. A consultoria ajustará a melhor data!
                                </small>
                            </div>
                        </div>
                        
                        {/* CORREÇÃO DA CLASSE DE ERRO */}
                        {erro && <p className="error-message">{erro}</p>}

                        {/* 4. CORREÇÃO DO BOTÃO: Usa a classe BEM btn btn--form */}
                        <button type="submit" className="btn btn--form" disabled={loading}>
                            <i className="fab fa-whatsapp"></i> {loading ? 'Salvando Lead...' : 'Enviar Pedido via WhatsApp'}
                        </button>
                    </form>
                    
                    {/* 5. CORREÇÃO DO RODAPÉ: Usa a classe BEM footer */}
                    <footer className="footer" style={{ background: 'transparent', color: 'var(--text-color)', padding: 'var(--space-md) 0' }}>
                        <p>&copy; 2023 FSR Viagens & Turismo. Todos os direitos reservados.</p>
                    </footer>
                </div>
            );
        };
        
        // Renderiza o componente React
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<LandingPageIncomum />);
    </script>
</body>
</html>

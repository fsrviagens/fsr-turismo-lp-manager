<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FSR Viagens | Consultoria Especializada e Pacotes Exclusivos (5% OFF)</title>
    
    <link rel="stylesheet" href="/static/style.css"> 
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <meta name="description" content="Consultoria de viagens especializada desde 2004. Escolha seu pacote FSR e garanta 5% de comiss√£o no fechamento imediato.">

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    </head>
<body>
    <div id="root">
    </div>

    <script type="text/babel">
        // Endpoints e Constantes
        const API_PAC_URL = '/api/pacotes'; 
        const WHATSAPP_NUMBER = '5561983163710';
        const API_LEAD_URL = '/capturar_lead';
        const TELEFONE_REGEX = /^\d{10,11}$/; 
        
        // Gatilho de Compra / Comiss√£o
        const PROSPECT_COMMISSION = '5%';
        const BASE_COMMISSION = '10%'; 
        
        // Mapeamento de Descritivos (Para enriquecer a mensagem do WhatsApp)
        const DESCRITIVOS_ROTEIROS = {
            "Fortaleza com Praia da Lagoinha": "‚òÄÔ∏è Fortaleza: Roteiro perfeito para quem ama sol, mar e aventura. Inclui a beleza r√∫stica da Praia da Lagoinha e o agito da capital cearense.",
            "Salvador com Morro de S√£o Paulo": "üèùÔ∏è Salvador e Morro: Uma combina√ß√£o imbat√≠vel de cidade hist√≥rica e ilha sem carros. Descanse e explore as famosas praias de Morro de S√£o Paulo.",
            "Egito 2X1 | Pacote 08 dias e 07 noites": "üê™ Egito: Viaje com quem entende! Pacote 2X1, uma jornada pela hist√≥ria milenar, pir√¢mides e cruzeiro pelo Nilo. Oportunidade √∫nica!",
            "R√©veillon na Tail√¢ndia com Festival das Lanternas": "üéá Tail√¢ndia: Celebre o R√©veillon com o m√°gico Festival das Lanternas (Yi Peng). Praias paradis√≠acas e templos milenares esperam por voc√™. Exclusivo!",
            "Len√ß√≥is Maranhenses - S√£o Lu√≠s e Barreirinhas": "üíß Len√ß√≥is Maranhenses: Descubra a beleza surreal das lagoas entre dunas. Um ecoturismo inesquec√≠vel combinando S√£o Lu√≠s e Barreirinhas.",
            "Porto de Galinhas e Maragogi": "üê† Porto de Galinhas e Maragogi: O melhor do Nordeste! Mergulhe nas piscinas naturais e desfrute do famoso 'Caribe Brasileiro'.",
            "R√©veillon 2026 - Cost√£o do Santinho Resort": "üéâ Cost√£o do Santinho: R√©veillon All Inclusive em um dos resorts mais desejados do Brasil. Garanta sua vaga com as melhores condi√ß√µes.",
            "Grand Turquia Extra 2026 Essencial": "üáπüá∑ Turquia: Pacote Essencial pela Turquia, visitando Istambul, Capad√≥cia e Pamukkale. Cultura, hist√≥ria e paisagens inesquec√≠veis.",
            "Montevid√©u Bloqueio Exclusivo": "üç∑ Montevid√©u: Bloqueio exclusivo para a capital uruguaia. Hist√≥ria, gastronomia e vinhos em uma viagem charmosa e acess√≠vel.",
            // **IMPORTANTE: ADICIONE MAIS CHAVES:VALORES AQUI** para o restante dos pacotes varridos.
        };

        // Fun√ß√£o utilit√°ria para obter a data m√≠nima permitida (hoje + 4 dias)
        const getMinDate = () => {
            const date = new Date();
            date.setDate(date.getDate() + 4); 
            return date.toISOString().split('T')[0];
        };
        
        // Fun√ß√£o para obter o descritivo a partir do nome do pacote
        const obterDescritivoRoteiro = (pacoteNomeCompleto) => {
            // Tenta encontrar a chave no mapeamento, ignorando a Sa√≠da
            // Ex: Transforma "Egito 2X1 | Pacote..." em "Egito 2X1 | Pacote 08 dias e 07 noites"
            const nomeBase = pacoteNomeCompleto.split('|')[0].trim(); 
            
            // Retorna a descri√ß√£o mapeada ou um fallback de consultoria
            return DESCRITIVOS_ROTEIROS[nomeBase] || "‚úàÔ∏è Consultoria Exclusiva: Conte-nos seus sonhos para criarmos uma experi√™ncia Incomum, com 5% de comiss√£o extra no fechamento imediato!";
        };

        const LandingPageFSR = () => { 
            const [nome, setNome] = React.useState('');
            const [telefone, setTelefone] = React.useState('');
            const [pacoteSelecionado, setPacoteSelecionado] = React.useState('');
            const [dataViagem, setDataViagem] = React.useState('');
            const [passageiros, setPassageiros] = React.useState(1); 
            const [erro, setErro] = React.useState('');
            const [loadingLead, setLoadingLead] = React.useState(false); 
            
            // Novos estados para o carregamento dos pacotes
            const [pacotes, setPacotes] = React.useState([]);
            const [pacotesLoading, setPacotesLoading] = React.useState(true);
            const [erroPacotes, setErroPacotes] = React.useState('');

            const minDate = React.useMemo(() => getMinDate(), []); 

            // ----------------------------------------------------
            // USE EFFECT: Busca de pacotes (Chamada Real do Backend)
            // ----------------------------------------------------
            React.useEffect(() => {
                const fetchPacotes = async () => {
                    setPacotesLoading(true);
                    setErroPacotes('');

                    try {
                        // CHAMA O ENDPOINT REAL (Gunicorn e Scraping)
                        const response = await fetch(API_PAC_URL); 
                        const data = await response.json();
                        
                        if (response.ok) {
                            setPacotes(data);
                        } else {
                            // Erro retornado pelo backend
                            setErroPacotes(data.message || 'Erro ao carregar os pacotes do servidor.');
                            setPacotes([]); // Garante que a lista esteja vazia em caso de erro.
                        }
                        
                    } catch (error) {
                        console.error("Erro de rede ao carregar pacotes:", error);
                        setErroPacotes('Falha de conex√£o. Por favor, tente recarregar a p√°gina.');
                        setPacotes([]);
                    } finally {
                        setPacotesLoading(false);
                    }
                };

                fetchPacotes();
            }, []);
            // ----------------------------------------------------


            const handlePassageirosChange = (e) => {
                const value = e.target.value;
                
                if (value === '') {
                    setPassageiros(''); 
                    return;
                }

                let num = parseInt(value);
                
                if (!isNaN(num) && num >= 1) {
                    setPassageiros(num);
                } 
                else if (num < 1) {
                    setPassageiros(1);
                }
            };

            const validateForm = (finalPassageiros) => {
                if (!nome || !telefone || !pacoteSelecionado) {
                    setErro('‚ùå Falta pouco! Por favor, preencha o Nome, Telefone e Pacote antes de prosseguir.');
                    return false;
                }
                
                if (!TELEFONE_REGEX.test(telefone)) {
                    setErro('‚ùå Telefone inv√°lido. Insira apenas os 10 ou 11 d√≠gitos, incluindo o DDD (Ex: 61983163710).');
                    return false;
                }

                if (finalPassageiros < 1) {
                    setErro('‚ùå O n√∫mero de passageiros deve ser no m√≠nimo 1.');
                    return false;
                }

                // VALIDA√á√ÉO DE DATA: M√≠nimo 4 dias de anteced√™ncia
                if (dataViagem && dataViagem < minDate) {
                    const minDateFormatted = new Date(minDate).toLocaleDateString('pt-BR');
                    setErro(`‚ùå A data de viagem deve ser no m√≠nimo ${minDateFormatted} (4 dias de anteced√™ncia para processamento).`);
                    return false;
                }
                
                return true;
            };

            const handleWhatsAppRedirect = async (e) => {
                e.preventDefault();
                setErro('');
                
                const finalPassageiros = parseInt(passageiros) || 1;
                
                if (!validateForm(finalPassageiros)) {
                    return;
                }
                
                setLoadingLead(true);

                const formData = {
                    nome, telefone, pacoteSelecionado, dataViagem, passageiros: finalPassageiros
                };

                // --- Gera√ß√£o do Descritivo e Mensagem para o WhatsApp ---
                const descritivoRoteiro = obterDescritivoRoteiro(pacoteSelecionado);

                let mensagem = `*PRIORIDADE - NOVO LEAD (SITE)*
Ol√°, FSR Viagens & Turismo! Meu nome √© ${nome}.
Estou entrando em contato para garantir a comiss√£o especial de ${PROSPECT_COMMISSION}%.

*1. Pacote de Interesse:*
‚úàÔ∏è *${pacoteSelecionado}*
${descritivoRoteiro}

*2. Detalhes da Solicita√ß√£o:*
- Passageiros: ${finalPassageiros}
- Data Pretendida: ${dataViagem ? new Date(dataViagem).toLocaleDateString('pt-BR', {timeZone: 'UTC'}) : 'Ainda a definir (Gostaria de op√ß√µes)'}

*3. Dados do Lead (Para Funil Power BI):*
- Nome: ${nome}
- Telefone: ${telefone}
- A√ß√£o: Fechamento Imediato (${PROSPECT_COMMISSION} OFF)
`;

                const encodedMessage = encodeURIComponent(mensagem);
                const whatsappURL = `https://api.whatsapp.com/send?phone=${WHATSAPP_NUMBER}&text=${encodedMessage}`;
                // --- Fim da Mensagem ---


                // Enviando Lead para /capturar_lead (Funil Power BI)
                try {
                    const response = await fetch(API_LEAD_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });

                    if (!response.ok) {
                        const result = await response.json();
                        console.error("Erro ao salvar o lead no servidor (Automa√ß√£o):", result.message);
                    }
                    
                    // Sucesso: Abre o WhatsApp
                    window.open(whatsappURL, '_blank');
                    
                } catch (error) {
                    setErro('‚ùå Erro de comunica√ß√£o de rede. Por favor, verifique sua conex√£o ou tente novamente.');
                    console.error("Erro de rede:", error);
                } finally {
                    setLoadingLead(false);
                }
            };

            return (
                <div className="container form-container">
                    <header className="header__content">
                        <img 
                            src="/static/logo_fsr0.webp" 
                            alt="FSR Viagens & Turismo Logo" 
                            className="logo__image"
                            width="200"
                            height="100" 
                        />
                        <h1 className="hero__headline">
                            Pacotes Exclusivos com Consultoria T√©cnica Especializada
                        </h1>
                        <p className="hero__slogan">
                            Sua viagem Incomum come√ßa aqui! Selecione o roteiro e garanta um atendimento **priorit√°rio** e a sua **Comiss√£o Exclusiva**.
                        </p>
                        
                        {/* GATILHO DE ESCASSEZ E URG√äNCIA */}
                        <div className="offer-banner">
                            ‚ú® OFERTA REL√ÇMPAGO: Fechamento Imediato garante **${PROSPECT_COMMISSION}** de Comiss√£o! (Comiss√£o base: ${BASE_COMMISSION})
                        </div>
                    </header>

                    <form onSubmit={handleWhatsAppRedirect} className="form">
                        
                        {/* 1. Sele√ß√£o do Pacote */}
                        <fieldset className="form__fieldset" disabled={pacotesLoading}> 
                            <legend className="form__legend">1. Selecione a Viagem dos Seus Sonhos *</legend>
                            <div className="form__group">
                                <label htmlFor="pacote-select">Pacote de Interesse:</label>
                                
                                {/* ESTADO DE CARREGAMENTO REALISTA (UX OTIMIZADA) */}
                                {pacotesLoading && (
                                    <p className="loading-message">
                                        <i className="fas fa-plane fa-spin"></i> Varrendo as op√ß√µes da Vitrine em tempo real...
                                    </p>
                                )}

                                {/* MENSAGEM DE ERRO DOS PACOTES */}
                                {erroPacotes && (
                                    <p className="error-message">{erroPacotes}. Tente recarregar ou consulte por WhatsApp.</p>
                                )}

                                {/* SELETOR DE PACOTES CARREGADOS */}
                                {!pacotesLoading && pacotes.length > 0 && (
                                    <select
                                        id="pacote-select"
                                        value={pacoteSelecionado}
                                        onChange={(e) => setPacoteSelecionado(e.target.value)}
                                        required
                                        title="Escolha um dos pacotes varridos diretamente da vitrine FSR."
                                    >
                                        <option value="">-- Escolha um Destino Irresist√≠vel --</option>
                                        {pacotes.map((pacote) => (
                                            <option key={pacote.id} value={`${pacote.nome} | Sa√≠da: ${pacote.saida}`}>
                                                {pacote.nome} (Sa√≠da: {pacote.saida})
                                            </option>
                                        ))}
                                    </select>
                                )}
                                
                                {/* Fallback se n√£o houver pacotes */}
                                {!pacotesLoading && pacotes.length === 0 && !erroPacotes && (
                                    <p className="error-message">Nenhum pacote dispon√≠vel. Por favor, entre em contato para **Consultoria Personalizada**.</p>
                                )}
                            </div>
                        </fieldset>
                        
                        {/* 2. Dados Pessoais */}
                        <fieldset className="form__fieldset">
                            <legend className="form__legend">2. Seus Dados * (Atendimento Priorit√°rio)</legend>
                            <div className="form__group">
                                <label htmlFor="nome-input">Nome Completo:</label>
                                <input id="nome-input" type="text" value={nome} onChange={(e) => setNome(e.target.value)} placeholder="Seu nome (Obrigat√≥rio)" required/>
                            </div>
                            <div className="form__group">
                                <label htmlFor="telefone-input">WhatsApp (apenas n√∫meros, com DDD):</label>
                                <input id="telefone-input" type="tel" value={telefone} onChange={(e) => setTelefone(e.target.value.replace(/[^0-9]/g, ''))} placeholder="Ex: 61983163710 (Obrigat√≥rio)" minLength="10" maxLength="11" required/>
                                <small className="help-text">Prioridade no contato se for n√∫mero de WhatsApp v√°lido.</small>
                            </div>
                        </fieldset>

                        {/* 3. Detalhes da Viagem */}
                        <fieldset className="form__fieldset">
                            <legend className="form__legend">3. Detalhes da Viagem (Consultoria Especializada)</legend>
                            <div className="form__group">
                                <label htmlFor="passageiros-input">Quantidade de Passageiros *:</label>
                                <input id="passageiros-input" type="number" min="1" value={passageiros} onChange={handlePassageirosChange} required/>
                            </div>
                            <div className="form__group">
                                <label htmlFor="data-viagem-input">Data Preferencial (M√≠nimo 4 dias):</label>
                                <input 
                                    id="data-viagem-input" 
                                    type="date" 
                                    value={dataViagem} 
                                    onChange={(e) => setDataViagem(e.target.value)} 
                                    min={minDate}
                                    title="A data deve ter no m√≠nimo 4 dias de anteced√™ncia."
                                />
                                <small className="help-text">Quanto mais detalhado, mais r√°pida a consultoria.</small>
                            </div>
                        </fieldset>

                        {/* Acessibilidade para mensagens de erro */}
                        {erro && <p className="error-message form__alert" role="alert" aria-live="assertive" aria-atomic="true">{erro}</p>}

                        <button type="submit" className="btn btn--cta" disabled={loadingLead || pacotesLoading}>
                            <i className="fab fa-whatsapp"></i> 
                            {loadingLead ? 'Processando dados e Conectando...' : 
                            `Quero ${PROSPECT_COMMISSION} OFF! Falar com o Consultor Especialista`}
                        </button>
                        
                        <p className="final-call-to-action">
                            <i className="fas fa-tag"></i> *Oferta por tempo limitado. O valor da comiss√£o ser√° aplicado no fechamento final do pacote.
                        </p>
                    </form>
                    
                    <footer className="footer">
                        <p className="expert-seal">
                            Consultoria T√©cnica Especializada desde <i className="fas fa-user-tie"></i> **2004** | Seu desenvolvedor e vendedor com bagagem de mercado.
                        </p>
                        <p>Atendimento R√°pido e Personalizado | <span className="whatsapp-link">WhatsApp: {WHATSAPP_NUMBER}</span></p>
                        <p>&copy; 2023 FSR Viagens & Turismo. Todos os direitos reservados.</p>
                    </footer>
                </div>
            );
        };
        
        // Renderiza o componente React
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<LandingPageFSR />);
    </script>
</body>
</html>
